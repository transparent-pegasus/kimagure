# 実装計画: Google認証機能とUI/UX改善

## 概要
`docs/todo.md` に基づき、Googleログイン機能の実装と、既存UI/UXの改善を行います。

## フェーズ 1: 認証機能の強化 (Google Login)

- [x] **ログイン画面の実装** (優先度: 高)
  - [x] ログインページ (`/login` 相当のコンポーネント) を作成する。
  - [x] Googleログインボタンを配置する。
  - [x] 匿名ログインボタンを配置する（Googleログインの下に配置）。
  - [x] 既存の認証フロー（匿名ログインのみ）からの移行パスを確認する。
- [x] **データ連携** (優先度: 高)
  - [x] 既存の匿名ユーザーデータとGoogleアカウントの紐付け処理（リンク機能）を検討・実装する（Firebase Auth）。
  - [x] Firestoreのセキュリティルールを確認し、認証済みユーザーのみアクセス可能であることを再確認する。

## フェーズ 2: UI/UX改善 (Visual & Layout)

- [x] **入力フォームの改善**
  - [x] **食事プラン入力欄**: モバイル表示時の右余白を小さくし、文字サイズを小さく調整する。
  - [x] **条件設定スイッチ**: `wbr` タグが機能していない問題を修正し、改行位置を適正化する。
  - [x] **プロフィール入力**: 生年(西暦)・性別入力欄とカロリー入力欄の間に矢アイコン等を追加し、フロー（入力→計算結果）を視覚的に分かりやすくする。
  - [x] **NG食材表示**: レイアウトを変更し、NG食材名を1段目、その他の入力を2段目とする構成にする。
  - [x] **プレースホルダ変更**: リクエスト入力欄のプレースホルダの区切り文字を「、」に変更する。

- [x] **履歴リストの改善**
  - [x] **カード全体のリンク化**: 履歴リストのアイテム全体をクリック可能にする。
  - [x] **フォントサイズ調整**: メニュー部分の文字サイズを小さくし、最大3行表示に調整する。

- [x] **提案・保存フローの改善**
  - [x] **保存完了UI**: 献立保存時の完了メッセージを `window.alert` からモーダル（Dialog）に変更する。
  - [x] **複数選択**: 食事プランの提案を選択する際、複数選択を可能にする（要件の詳細確認が必要: UI的な複数選択か、ロジック的な複数採用か）。

## フェーズ 3: ロジック・ナビゲーション修正

- [x] **テキスト置換処理**
  - [x] AI回答に含まれるコンビニ名を短縮形に置換する処理を追加する（例: 「セブン-イレブン」→「セブン」、「ファミリーマート」→「ファミマ」）。
- [x] **ナビゲーション修正**
  - [x] 履歴詳細画面から提案画面への遷移が機能していない問題を修正する。

## フェーズ 4: 開発ツールの導入とUIの最終調整

- [x] **デベロッパースキルの定義**
  - [x] `create-plan`: `todo.md` から計画を自動生成するスキル。
  - [x] `git-sync`: Git操作を自動化するスキル。
  - [x] `change-cwd`: ディレクトリ移動を管理するスキル。
- [x] **UIの最終クリーンアップ**
  - [x] **ヘッダーの統一**: ページ内の重複ヘッダーを削除し、共通コンポーネントに統合。ログアウト機能を共通ヘッダーに実装。
  - [x] **モバイル最適化（食事プラン）**: ラベル幅の縮小とプレースホルダのフォントサイズ縮小。
  - [x] **レイアウト調整**: 栄養バランスとプロフィールの間に区切り線を追加。
  - [x] **不要なスタイルの削除**: 各コンポーネントの不要な `z-10` を削除。
  - [x] **余白・スクロール調整**: 制限項目追加ボタンの形式的独立と、追加時のスクロール量を調整。
  - [x] **履歴画面の微調整**: 「履歴なし」メッセージの表示位置調整。

## フェーズ 5: レスポンシブ表示の再調整

- [x] **履歴画面の状態表示**
  - [x] 「履歴はまだありません」のメッセージをモバイルでは中央寄せ、PC/タブレットでは左寄せにする。
- [x] **食事プラン入力欄のレスポンシブ化**
  - [x] モバイルでのラベル幅縮小とプレースホルダサイズ縮小をレスポンシブ（モバイルのみ）に限定し、PC表示では元のサイズを維持。
- [x] **NG食材セクションの微調整**
  - [x] 制限項目追加ボタンを `space-y-3` のラッパーから外して独立させ、`mt-6` を適用して適切な余白を確保。

## フェーズ 6: 不具合修正とUX改善

- [x] **画面遷移・スクロールの最適化**
  - [x] `suggest_menu` リクエスト時に画面全体をローディング表示に切り替えるのではなく、オーバーレイ表示にすることでスクロール位置の維持とレイアウトシフトを防止。
  - [x] APIリクエスト完了後、結果画面に遷移しない問題を修正（`useEffect` の条件見直し）。

## 手動確認チェックリスト

- [x] **認証**
  - [x] 未ログイン状態でアプリを開くとログイン画面が表示される（またはLPから遷移）。
  - [x] Googleログインでサインインできる。
  - [x] 匿名ログインでサインインできる。
  - [x] 共通ヘッダーのボタンからログアウトできる。
- [x] **入力・表示**
  - [x] モバイル端末でのみラベル幅が小さくなっていることを確認。
  - [x] PC端末ではラベル幅が十分（3rem相当）確保されていることを確認。
  - [x] 条件設定のセクションに区切り線が表示されていること。
  - [x] 画面上部の重複したタイトルやロゴが消えていること。
- [x] **履歴**
  - [x] モバイル端末で「履歴なし」が中央寄せされていること。
  - [x] 履歴リストのカードのどこをタップしても詳細に遷移すること。
- [x] **提案・保存**
  - [x] 献立保存時にアプリ内のモーダルが表示されること。
  - [x] 提案された内容のコンビニ名が短縮形になっていること。
  - [x] 「献立を決める」ボタン押下時に画面がちらつかず（スクロール位置が飛ばず）、オーバーレイが表示されること。
  - [x] 提案完了後、自動的に結果画面に遷移すること。
